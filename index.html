<!DOCTYPE html>
<html lang="zh-HK">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <!-- 讓 Web App 在 iOS 舊版也能隱藏網址列 (必須加入主畫面) -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>HK Flip Clock Legacy</title>
    <style>
        /* 重置 */
        * { margin: 0; padding: 0; box-sizing: border-box; -webkit-box-sizing: border-box; }
        
        body {
            font-family: Helvetica, Arial, sans-serif; /* 使用舊版系統字體 */
            background: #000; /* 預設黑底 */
            background-image: url('https://images.unsplash.com/photo-1556206079-747a7d467485?q=80&w=1024&auto=format&fit=crop');
            background-size: cover;
            background-position: center;
            height: 100vh;
            width: 100%;
            overflow: hidden;
            color: #fff;
            -webkit-user-select: none;
        }

        /* 舊設備的遮罩，不用 backdrop-filter 改用半透明色 */
        .mask {
            position: absolute;
            top: 0; left: 0; right: 0; bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            z-index: 0;
        }

        .container {
            position: relative;
            z-index: 1;
            width: 95%;
            max-width: 600px;
            margin: 0 auto;
            height: 100%;
            display: -webkit-flex; /* iOS 9 Flexbox */
            display: flex;
            -webkit-flex-direction: column;
            flex-direction: column;
            -webkit-justify-content: center;
            justify-content: center;
            -webkit-align-items: center;
            align-items: center;
        }

        /* --- 時鐘區 --- */
        .clock-wrapper {
            display: -webkit-flex;
            display: flex;
            -webkit-justify-content: center;
            justify-content: center;
            margin-bottom: 30px;
        }

        .flip-unit {
            width: 70px;
            height: 100px;
            background: #2c2c2e;
            border-radius: 8px;
            margin: 0 5px;
            position: relative;
            font-size: 60px;
            line-height: 100px;
            text-align: center;
            font-weight: bold;
            box-shadow: 0 4px 10px rgba(0,0,0,0.5);
        }

        /* 針對 iPad 調整大小 */
        @media (min-width: 768px) {
            .flip-unit { width: 100px; height: 140px; font-size: 90px; line-height: 140px; margin: 0 10px; }
        }

        /* 簡化版翻頁：不使用複雜的 3D 堆疊，改用簡單的變換 */
        .flip-text {
            display: block;
            width: 100%;
            height: 100%;
            color: #f2f2f7;
        }

        .colon {
            font-size: 50px;
            line-height: 90px;
            color: rgba(255,255,255,0.7);
            margin: 0 5px;
        }
        @media (min-width: 768px) { .colon { font-size: 80px; line-height: 130px; } }

        /* --- 資訊卡片 (不使用 Grid，改用 Flex) --- */
        .bento-row {
            display: -webkit-flex;
            display: flex;
            width: 100%;
            -webkit-justify-content: space-between;
            justify-content: space-between;
            -webkit-flex-wrap: wrap;
            flex-wrap: wrap;
        }

        .card {
            background: rgba(30, 30, 32, 0.85); /* 提高不透明度以彌補沒有模糊效果 */
            border: 1px solid rgba(255,255,255,0.1);
            border-radius: 12px;
            padding: 15px;
            margin-bottom: 10px;
            /* 模擬 Grid 佈局 */
            width: 32%; 
            height: 110px;
            display: -webkit-flex;
            display: flex;
            -webkit-flex-direction: column;
            flex-direction: column;
            -webkit-justify-content: space-between;
            justify-content: space-between;
        }

        /* 手機版/直向變成兩行 */
        @media (max-width: 600px) {
            .card { width: 48%; }
            .card:last-child { width: 100%; } /* 最後一個佔滿 */
        }

        .card-label {
            font-size: 12px;
            color: #aaa;
            text-transform: uppercase;
            letter-spacing: 1px;
            display: -webkit-flex;
            display: flex;
            -webkit-align-items: center;
            align-items: center;
        }
        
        .card-value {
            font-size: 24px;
            font-weight: bold;
            color: #fff;
        }
        
        .card-sub {
            font-size: 12px;
            color: #bbb;
            margin-top: 2px;
        }

        .progress-bg {
            width: 100%;
            height: 5px;
            background: rgba(255,255,255,0.2);
            border-radius: 3px;
            margin-top: 10px;
            overflow: hidden;
        }
        
        .progress-bar {
            height: 100%;
            background: #30d158;
            width: 0%;
            -webkit-transition: width 0.5s;
            transition: width 0.5s;
        }

        /* 舊版 iOS 隱藏全螢幕按鈕，改用提示文字 */
        .tips {
            position: absolute;
            bottom: 10px;
            width: 100%;
            text-align: center;
            font-size: 12px;
            color: rgba(255,255,255,0.4);
        }

    </style>
</head>
<body>

    <div class="mask"></div>

    <div class="container">
        <!-- 時鐘 -->
        <div class="clock-wrapper">
            <div class="flip-unit"><span class="flip-text" id="h">00</span></div>
            <div class="colon">:</div>
            <div class="flip-unit"><span class="flip-text" id="m">00</span></div>
            <div class="colon">:</div>
            <div class="flip-unit"><span class="flip-text" id="s">00</span></div>
        </div>

        <!-- 資訊區 -->
        <div class="bento-row">
            <!-- 日期 -->
            <div class="card">
                <div class="card-label">HK Date</div>
                <div>
                    <div class="card-value" id="date-d">--</div>
                    <div class="card-sub" id="date-w">--</div>
                </div>
            </div>

            <!-- 天氣 -->
            <div class="card">
                <div class="card-label">Weather</div>
                <div>
                    <div class="card-value" id="temp">--°</div>
                    <div class="card-sub" id="weather">Loading</div>
                </div>
            </div>

            <!-- 下班 -->
            <div class="card">
                <div class="card-label">Off Work</div>
                <div style="width:100%">
                    <div class="card-value" id="countdown">--:--:--</div>
                    <div class="progress-bg">
                        <div class="progress-bar" id="bar"></div>
                    </div>
                </div>
            </div>
        </div>

        <div class="tips">iPad Mini 1: 請使用「加入主畫面」以全螢幕顯示</div>
    </div>

    <script>
        // --- 設定區 (使用 ES5 變數 var) ---
        var CONFIG = {
            offHour: 17,    // 下班時
            offMin: 50,     // 下班分
            workLen: 9      // 工時
        };

        // --- 核心功能 (ES5) ---
        
        function updateClock() {
            // 處理時區問題 (手動計算 UTC+8)
            var now = new Date();
            // 取得 UTC 時間
            var utc = now.getTime() + (now.getTimezoneOffset() * 60000);
            // 加上 8 小時 (香港)
            var hkTime = new Date(utc + (3600000 * 8));

            var h = ('0' + hkTime.getHours()).slice(-2);
            var m = ('0' + hkTime.getMinutes()).slice(-2);
            var s = ('0' + hkTime.getSeconds()).slice(-2);

            // 更新 DOM (不使用複雜動畫以確保流暢)
            setText('h', h);
            setText('m', m);
            setText('s', s);

            updateDate(hkTime);
            updateCountdown(hkTime);
        }

        function setText(id, val) {
            var el = document.getElementById(id);
            if(el.innerHTML !== val) {
                el.innerHTML = val;
            }
        }

        function updateDate(d) {
            var days = ['Sunday', 'Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday'];
            setText('date-d', (d.getMonth() + 1) + '月' + d.getDate() + '日');
            setText('date-w', days[d.getDay()]);
        }

        function updateCountdown(now) {
            var target = new Date(now.getTime());
            target.setHours(CONFIG.offHour, CONFIG.offMin, 0, 0);

            if (now > target) {
                target.setDate(target.getDate() + 1);
            }

            var diff = target - now;
            
            // 判斷下班或週末
            var day = now.getDay();
            var elCount = document.getElementById('countdown');
            var elBar = document.getElementById('bar');
            
            // 簡單邏輯：如果是今天已經下班(目標是明天)，或者週末
            var isWeekend = (day === 0 || day === 6);
            var isAfterWork = (target.getDate() !== now.getDate());

            if (isWeekend) {
                elCount.innerHTML = "Weekend";
                elCount.style.color = "#30d158";
                elBar.style.width = "100%";
            } else if (isAfterWork) {
                elCount.innerHTML = "Enjoy!";
                elCount.style.color = "#30d158";
                elBar.style.width = "100%";
            } else {
                var hr = Math.floor(diff / 3600000);
                var mn = Math.floor((diff % 3600000) / 60000);
                var sc = Math.floor((diff % 60000) / 1000);
                
                elCount.innerHTML = hr + ':' + ('0'+mn).slice(-2) + ':' + ('0'+sc).slice(-2);
                elCount.style.color = "#fff";

                var total = CONFIG.workLen * 3600000;
                var pct = 100 - ((diff / total) * 100);
                if(pct < 0) pct = 0;
                if(pct > 100) pct = 100;
                elBar.style.width = pct + '%';
            }
        }

        // --- 舊版 Ajax 請求 (XMLHttpRequest) ---
        function fetchWeather() {
            var xhr = new XMLHttpRequest();
            // 香港天文台 API
            xhr.open('GET', 'https://data.weather.gov.hk/weatherAPI/opendata/weather.php?dataType=rhrread&lang=tc', true);
            
            xhr.onreadystatechange = function() {
                if (xhr.readyState === 4) {
                    if (xhr.status === 200) {
                        try {
                            var data = JSON.parse(xhr.responseText);
                            var tempVal = data.temperature.data[0].value;
                            
                            // 嘗試找天文台的溫度
                            for(var i=0; i<data.temperature.data.length; i++) {
                                if(data.temperature.data[i].place === "香港天文台") {
                                    tempVal = data.temperature.data[i].value;
                                    break;
                                }
                            }

                            setText('temp', tempVal + '°c');
                            
                            var desc = "濕度 " + data.humidity.data[0].value + "%";
                            if(data.warningMessage && data.warningMessage.length > 0) {
                                desc = "有警告";
                            } else if (data.rainfall && data.rainfall.data.length > 0) {
                                // 簡單檢查有沒有雨
                                var rain = false;
                                for(var j=0; j<data.rainfall.data.length; j++) {
                                    if(data.rainfall.data[j].max > 0) rain = true;
                                }
                                if(rain) desc = "有雨";
                            }

                            setText('weather', desc);

                        } catch(e) {
                            setText('weather', 'Error');
                        }
                    }
                }
            };
            
            // 舊設備容錯處理
            xhr.onerror = function() {
                setText('weather', 'Offline');
            };

            xhr.send();
        }

        // --- 啟動 ---
        setInterval(updateClock, 1000);
        updateClock();
        
        // 天氣每 15 分鐘更新一次
        fetchWeather();
        setInterval(fetchWeather, 900000); 

    </script>
</body>
</html>