<!DOCTYPE html>
<html lang="zh-HK">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <!-- iOS 舊版全螢幕設定 -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>Flip Clock Responsive</title>
    <style>
        /* --- 基礎設定 --- */
        * { margin: 0; padding: 0; box-sizing: border-box; -webkit-box-sizing: border-box; }
        
        body {
            font-family: Helvetica, Arial, sans-serif;
            background: #000;
            background-image: url('https://images.unsplash.com/photo-1519501025264-65ba15a82390?q=80&w=1024&auto=format&fit=crop');
            background-size: cover;
            background-position: center;
            height: 100vh;
            width: 100%;
            overflow: hidden;
            color: #fff;
            -webkit-user-select: none;
            -webkit-text-size-adjust: 100%;
        }

        .overlay {
            position: absolute;
            top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0, 0, 0, 0.6);
            z-index: 0;
        }

        .container {
            position: relative;
            z-index: 1;
            width: 100%;
            height: 100%;
            display: -webkit-flex;
            display: flex;
            -webkit-flex-direction: column;
            flex-direction: column;
            -webkit-justify-content: center;
            justify-content: center;
            -webkit-align-items: center;
            align-items: center;
            padding: 20px;
            /* 讓過渡平滑一點 */
            transition: all 0.3s ease;
        }

        /* --- 翻頁時鐘結構 --- */
        .clock-container {
            display: -webkit-flex;
            display: flex;
            -webkit-align-items: center;
            align-items: center;
            margin-bottom: 40px;
            -webkit-perspective: 1000px;
            perspective: 1000px;
        }

        .flip-unit {
            position: relative;
            width: 140px;
            height: 220px;
            background: #202022;
            border-radius: 12px;
            margin: 0 6px;
            font-size: 160px;
            line-height: 220px;
            font-weight: bold;
            text-align: center;
            color: #f2f2f7;
            box-shadow: 0 10px 30px rgba(0,0,0,0.6);
            -webkit-transform-style: preserve-3d;
            transform-style: preserve-3d;
        }

        /* 上下半部結構 */
        .upper, .lower {
            position: absolute;
            left: 0;
            width: 100%;
            height: 50%;
            overflow: hidden;
            background: #2c2c2e;
            -webkit-backface-visibility: hidden;
            backface-visibility: hidden;
            /* 強制 GPU 加速防止抖動 */
            -webkit-transform: translate3d(0,0,0);
            transform: translate3d(0,0,0);
        }

        .upper {
            top: 0;
            border-radius: 12px 12px 0 0;
            border-bottom: 2px solid rgba(0,0,0,0.3);
            z-index: 1;
            -webkit-transform-origin: bottom;
            transform-origin: bottom;
        }

        .lower {
            bottom: 0;
            border-radius: 0 0 12px 12px;
            z-index: 0;
            -webkit-transform-origin: top;
            transform-origin: top;
        }

        .upper span, .lower span {
            display: block;
            width: 100%;
            height: 200%;
            line-height: 220px;
            text-align: center;
            -webkit-font-smoothing: antialiased; 
        }

        .upper span { -webkit-transform: translateY(0); transform: translateY(0); }
        .lower span { -webkit-transform: translateY(-50%); transform: translateY(-50%); }

        /* 動畫層 */
        .flip-down {
            z-index: 2;
            -webkit-animation: turnDown 0.5s ease-in forwards;
            animation: turnDown 0.5s ease-in forwards;
            -webkit-transform-style: preserve-3d;
            -webkit-backface-visibility: hidden;
        }

        @-webkit-keyframes turnDown {
            0% { -webkit-transform: rotateX(0deg); }
            100% { -webkit-transform: rotateX(-90deg); }
        }

        .colon {
            font-size: 100px;
            margin: 0 10px;
            color: rgba(255,255,255,0.4);
            margin-top: -20px;
        }

        /* --- 資訊卡片區 --- */
        .info-row {
            display: -webkit-flex;
            display: flex;
            width: 95%;
            max-width: 800px;
            -webkit-justify-content: space-between;
            justify-content: space-between;
        }

        .card {
            background: rgba(40, 40, 42, 0.9);
            border: 1px solid rgba(255,255,255,0.15);
            border-radius: 16px;
            padding: 20px;
            width: 32%;
            height: 140px;
            display: -webkit-flex;
            display: flex;
            -webkit-flex-direction: column;
            flex-direction: column;
            -webkit-justify-content: space-between;
            justify-content: space-between;
        }

        .card-title {
            font-size: 16px;
            color: #aaa;
            text-transform: uppercase;
            letter-spacing: 1px;
            font-weight: bold;
        }

        .card-main {
            font-size: 36px;
            font-weight: bold;
            white-space: nowrap;
        }

        .card-sub {
            font-size: 16px;
            color: #ccc;
        }

        .bar-bg {
            width: 100%;
            height: 8px;
            background: rgba(255,255,255,0.2);
            border-radius: 4px;
            margin-top: 10px;
            overflow: hidden;
        }
        .bar-fill {
            height: 100%;
            background: #30d158;
            width: 0%;
            -webkit-transition: width 0.5s;
            transition: width 0.5s;
        }

        /* --- 直版 (Portrait) 專用設定 --- */
        @media (orientation: portrait) {
            /* 1. 調整整體佈局位置 */
            .container {
                -webkit-justify-content: flex-start;
                justify-content: flex-start;
                padding-top: 15vh; /* 內容往上移 */
            }

            /* 2. 時鐘縮小以適應手機寬度 */
            /* 使用 vw (viewport width) 確保 6 個數字能塞進一行 */
            .flip-unit {
                width: 11vw;  
                height: 16vw; 
                font-size: 12vw;
                line-height: 16vw;
                margin: 0 1vw;
                border-radius: 6px; /* 圓角縮小 */
            }

            /* RWD 內部 span 高度與行高 */
            .upper span, .lower span {
                line-height: 16vw;
            }

            .colon {
                font-size: 8vw;
                margin: 0 0.5vw;
                margin-top: -1vw;
            }
            
            .clock-container {
                margin-bottom: 30px;
            }

            /* 3. 卡片改為垂直堆疊 */
            .info-row {
                -webkit-flex-direction: column;
                flex-direction: column;
                width: 85%; /* 稍微縮窄 */
                max-width: none;
            }

            .card {
                width: 100%;       /* 填滿寬度 */
                height: 110px;     /* 高度稍微壓扁 */
                margin-bottom: 15px; /* 卡片間距 */
            }

            .card-title { font-size: 14px; }
            .card-main { font-size: 32px; }
        }

        /* 針對橫向但螢幕很小的設備 (如橫拿的手機) */
        @media (orientation: landscape) and (max-height: 600px) {
            .flip-unit { width: 80px; height: 120px; font-size: 80px; line-height: 120px; }
            .upper span, .lower span { line-height: 120px; }
            .colon { font-size: 50px; }
            .card { height: 100px; padding: 15px; }
            .card-main { font-size: 24px; }
            .clock-container { margin-bottom: 15px; }
        }

    </style>
</head>
<body>

    <div class="overlay"></div>

    <div class="container">
        <!-- 翻頁時鐘 -->
        <div class="clock-container">
            <div class="flip-unit" id="h-ten"></div>
            <div class="flip-unit" id="h-one"></div>
            <div class="colon">:</div>
            <div class="flip-unit" id="m-ten"></div>
            <div class="flip-unit" id="m-one"></div>
            <div class="colon">:</div>
            <div class="flip-unit" id="s-ten"></div>
            <div class="flip-unit" id="s-one"></div>
        </div>

        <!-- 資訊卡片 -->
        <div class="info-row">
            <!-- 日期 -->
            <div class="card">
                <div class="card-title">HK Date</div>
                <div>
                    <div class="card-main" id="date-main">--</div>
                    <div class="card-sub" id="date-sub">--</div>
                </div>
            </div>

            <!-- 天氣 -->
            <div class="card">
                <div class="card-title">Weather</div>
                <div>
                    <div class="card-main" id="weather-temp">--°</div>
                    <div class="card-sub" id="weather-desc">Loading</div>
                </div>
            </div>

            <!-- 下班 -->
            <div class="card">
                <div class="card-title">Off Work</div>
                <div style="width:100%">
                    <div class="card-main" id="off-timer" style="font-size:28px">--:--:--</div>
                    <div class="bar-bg">
                        <div class="bar-fill" id="off-bar"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // 設定區
        var CONFIG = {
            offHour: 17,
            offMin: 50,
            workLen: 9
        };

        // 初始化
        function initUnit(id) {
            var el = document.getElementById(id);
            el.setAttribute('data-val', '0');
            el.innerHTML = 
                '<div class="upper"><span>0</span></div>' + 
                '<div class="lower"><span>0</span></div>';
        }

        var ids = ['h-ten', 'h-one', 'm-ten', 'm-one', 's-ten', 's-one'];
        for(var i=0; i<ids.length; i++) initUnit(ids[i]);

        // 翻頁邏輯 (含防抖動)
        function updateFlip(id, digit) {
            var el = document.getElementById(id);
            var curr = el.getAttribute('data-val');

            if (curr === digit) return;

            var animUpper = document.createElement('div');
            // CSS 已強制 translate3d，此處只需加入 class
            animUpper.className = 'upper flip-down';
            animUpper.innerHTML = '<span>' + curr + '</span>';
            
            el.appendChild(animUpper);

            var staticUpper = el.querySelector('.upper span');
            var staticLower = el.querySelector('.lower span');
            
            staticUpper.innerText = digit;
            staticLower.innerText = digit;

            setTimeout(function() {
                el.removeChild(animUpper);
                el.setAttribute('data-val', digit);
            }, 500);
        }

        function runClock() {
            var now = new Date();
            var utc = now.getTime() + (now.getTimezoneOffset() * 60000);
            var hk = new Date(utc + (3600000 * 8));

            var h = ('0' + hk.getHours()).slice(-2);
            var m = ('0' + hk.getMinutes()).slice(-2);
            var s = ('0' + hk.getSeconds()).slice(-2);

            updateFlip('h-ten', h[0]);
            updateFlip('h-one', h[1]);
            updateFlip('m-ten', m[0]);
            updateFlip('m-one', m[1]);
            updateFlip('s-ten', s[0]);
            updateFlip('s-one', s[1]);

            updateInfo(hk);
        }

        function updateInfo(now) {
            var days = ['SUN', 'MON', 'TUE', 'WED', 'THU', 'FRI', 'SAT'];
            document.getElementById('date-main').innerText = (now.getMonth()+1) + '月' + now.getDate() + '日';
            document.getElementById('date-sub').innerText = days[now.getDay()];

            var target = new Date(now.getTime());
            target.setHours(CONFIG.offHour, CONFIG.offMin, 0, 0);
            
            if (now > target) target.setDate(target.getDate() + 1);

            var diff = target - now;
            var elT = document.getElementById('off-timer');
            var elB = document.getElementById('off-bar');

            var isW = (now.getDay()===0 || now.getDay()===6);
            
            if (isW) {
                elT.innerText = "WEEKEND";
                elT.style.color = "#30d158";
                elB.style.width = "100%";
            } else if (target.getDate() !== now.getDate()) {
                elT.innerText = "ENJOY";
                elT.style.color = "#30d158";
                elB.style.width = "100%";
            } else {
                var hr = Math.floor(diff/3600000);
                var mn = Math.floor((diff%3600000)/60000);
                var sc = Math.floor((diff%60000)/1000);
                elT.innerText = hr + ':' + ('0'+mn).slice(-2) + ':' + ('0'+sc).slice(-2);
                elT.style.color = "#fff";
                
                var pct = 100 - ((diff / (CONFIG.workLen*3600000)) * 100);
                elB.style.width = (pct > 100 ? 100 : pct) + '%';
            }
        }

        function fetchW() {
            var xhr = new XMLHttpRequest();
            xhr.open('GET', 'https://data.weather.gov.hk/weatherAPI/opendata/weather.php?dataType=rhrread&lang=tc', true);
            xhr.onreadystatechange = function() {
                if (xhr.readyState === 4 && xhr.status === 200) {
                    try {
                        var d = JSON.parse(xhr.responseText);
                        var val = d.temperature.data[0].value;
                        for(var i=0; i<d.temperature.data.length; i++) {
                            if(d.temperature.data[i].place === "香港天文台") val = d.temperature.data[i].value;
                        }
                        document.getElementById('weather-temp').innerText = val + '°';
                        
                        var desc = "濕度" + d.humidity.data[0].value + "%";
                        if(d.rainfall && d.rainfall.data.length > 0) {
                             for(var j=0; j<d.rainfall.data.length; j++) {
                                 if(d.rainfall.data[j].max > 0) { desc = "有雨"; break; }
                             }
                        }
                        document.getElementById('weather-desc').innerText = desc;
                    } catch(e) {}
                }
            };
            xhr.send();
        }

        setInterval(runClock, 1000);
        runClock();
        fetchW();
        setInterval(fetchW, 600000);

    </script>
</body>
</html>